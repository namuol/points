<!DOCTYPE html><html><head><meta charset="utf-8" /><link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" /><link rel="stylesheet" href="style.css" /><link rel="stylesheet" href="bootstrap/css/bootstrap-responsive.min.css" /></head><body><div class="navbar navbar-inverse navbar-fixed-top"><div class="navbar-inner"><div class="container"><a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a><a href="#/" class="brand">Points System</a><div class="nav-collapse collapse"></div><div id="not_logged_in"><ul id="log-in-nav" class="nav pull-right"><li class="dropdown"><a role="button" class="dropdown-toggle" data-toggle="dropdown">Log In <b class="caret"></b></a><div class="dropdown-menu" role="menu"><form id="log-in"><div class="control-group"><div class="controls"><div class="input-prepend"><span class="add-on"><i class="icon-user"></i></span><input id="log-in-name" type="text" placeholder="Username" /></div></div><div class="controls"><div class="input-prepend"><span class="add-on"><i class="icon-lock"></i></span><input id="log-in-pass" type="password" placeholder="Password" /></div></div></div><a class="forgot-password pull-left" href="#">Forgot password?</a><button class="btn pull-right">Log In</button></form></div></li></ul><ul id="sign-up-nav" class="nav pull-right"><li class="dropdown"><a role="button" class="dropdown-toggle" data-toggle="dropdown">Sign Up <b class="caret"></b></a><div class="dropdown-menu" role="menu"><form id="sign-up"><div class="control-group"><div class="controls"><div class="input-prepend"><span class="add-on"><i class="icon-envelope"></i></span><input id="sign-up-email" type="email" placeholder="Email" /></div></div><div class="controls"><div class="input-prepend"><span class="add-on"><i class="icon-envelope"></i></span><input id="sign-up-name" type="text" placeholder="Desired Username" /></div></div><div class="controls"><div class="input-prepend"><span class="add-on"><i class="icon-lock"></i></span><input id="sign-up-pass" type="password" placeholder="Password" /></div></div></div><button class="btn pull-right">Sign Up</button></form></div></li></ul></div><div id="logged_in"><ul id="nav_buttons" class="nav"><li id="master_slave_dropdown" class="dropdown"></li><li><a id="yours_link" href="#/yours">Yours</a></li><li><a id="theirs_link" href="#/theirs">Theirs</a></li></ul><div class="pull-right"><button id="myself" class="btn btn-info"><i class="icon-white icon-user"></i>&nbsp;<span class="username_display"></span></button>&nbsp;<button id="log-out" class="btn btn-inverse" type="submit">Log Out</button></div></div></div></div></div><div id="content" class="container"><div id="main" class="row content"><h1>Points.</h1></div><div id="user" class="content"><h3>User: <span class="user_username"></span></h3><div class="content not_subscribed"><br /><button id="subscribe" class="btn btn-success btn-xlarge"><i class="icon-hand-right icon-white"></i><strong> Add Master/Slave</strong></button></div><div class="content subscribed">You are already subscribed to <span class="user_username"></span></div></div><div id="current_user" class="content"><p>Give this url to your friend(s): <br /><div id="my_url" class="well well-small"><a></a></div><br /></p><form id="update_myself" class="form-horizontal"><div class="control-group"><label class="control-label" for="my_username">Username</label><div class="controls"><input id="my_username" class="input-xlarge" type="text" name="my_username" /></div></div><div class="control-group"><label class="control-label" for="credit_singular">Your Currency Name</label><div class="controls"><input id="credit_singular" class="input-xlarge" type="text" name="credit_singular" /></div></div><div class="control-group"><label class="control-label" for="credit_plural">Your Currency Name (Plural)</label><div class="controls"><input id="credit_plural" class="input-xlarge" type="text" name="credit_plural" /></div></div><div class="control-group"><div class="controls"><button type="submit" class="btn btn-primary"><strong>Update</strong></button></div></div></form></div><div id="yours" class="content"><div class="row"><h4><span class="master_slave_username"></span> has earned <span class="master_slave_points"></span> <span class="user_credit_plural"></span>.</h4></div><div class="row"><div class="span6"><legend>Chores to assign to <span class="master_slave_username"></span><span class="pull-right"><button id="add-chore" class="btn btn-primary"><i class="icon-plus icon-white"></i></button></span></legend><ul id="your_chores" class="item_list"></ul></div><div class="span6"><legend>Chores performed by <span class="master_slave_username"></span></legend><ul id="your_chores_performed" class="item_list"></ul></div></div><div class="row"><div class="span6"><legend>Rewards for <span class="master_slave_username"></span> to claim<span class="pull-right"><button id="add-reward" class="btn btn-primary"><i class="icon-plus icon-white"></i></button></span></legend><ul id="your_rewards" class="item_list"></ul></div><div class="span6"><legend>Rewards claimed by <span class="master_slave_username"></span></legend><ul id="your_rewards_claimed" class="item_list"></ul></div></div></div><div id="theirs" class="content"><div class="row"><h4>You have earned <span class="your_points"></span> <span class="master_slave_credit_plural"></span>.</h4></div><div class="row"><div class="span6"><legend>Chores to perform for <span class="master_slave_username"></span></legend><ul id="their_chores" class="item_list"></ul></div><div class="span6"><legend>Chores performed for <span class="master_slave_username"></span></legend><ul id="their_chores_performed" class="item_list"></ul></div></div><div class="row"><div class="span6"><legend>Rewards to claim from <span class="master_slave_username"></span></legend><ul id="their_rewards" class="item_list"></ul></div><div class="span6"><legend>Rewards claimed from <span class="master_slave_username"></span></legend><ul id="their_rewards_claimed" class="item_list"></ul></div></div></div></div><script src="//code.jquery.com/jquery-1.7.2.js"></script><script src="//www.parsecdn.com/js/parse-1.1.6.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/1.7.2/moment.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/sammy.js/0.7.1/sammy.min.js"></script><script src="bootstrap/js/bootstrap.min.js"></script><script src="coffeecup.js"></script><script>var __slice = Array.prototype.slice;var __hasProp = Object.prototype.hasOwnProperty;var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };var __extends = function(child, parent) {  for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; }  function ctor() { this.constructor = child; }  ctor.prototype = parent.prototype; child.prototype = new ctor; child.__super__ = parent.prototype;  return child; };var __indexOf = Array.prototype.indexOf || function(item) {  for (var i = 0, l = this.length; i < l; i++) {    if (this[i] === item) return i;  } return -1; };(function () {
      /*
      */

      /*
      */

      var chore_performed_template, chore_template, master_slave_dropdown_template, reward_template, their_chore_performed_template, their_chore_template, their_reward_claimed_template, their_reward_template, your_reward_claimed_template;
      chore_template = coffeecup.compile(function() {
        return li({
          'data-chore-id': '' + this.obj.id
        }, function() {
          button({
            "class": 'btn btn-mini btn-danger destroy'
          }, function() {
            return i({
              "class": 'icon-trash icon-white'
            });
          });
          text('&nbsp;');
          text(this.master_slave.get('username'));
          text(' may earn ');
          span({
            contenteditable: 'true',
            'data-attr': 'value'
          }, function() {
            return text(this.obj.get('value'));
          });
          text(' ');
          text(Parse.User.current().get('credit_plural') || 'points');
          text(' for ');
          span({
            contenteditable: 'true',
            'data-attr': 'name'
          }, function() {
            return text(this.obj.get('name'));
          });
          text('. ');
          return button({
            "class": 'btn btn-mini btn-success award'
          }, function() {
            return i({
              "class": 'icon-share-alt icon-white'
            });
          });
        });
      });
      chore_performed_template = coffeecup.compile(function() {
        return li({
          'data-chore-id': '' + this.obj.id
        }, function() {
          text('&nbsp;');
          text(this.master_slave.get('username'));
          text(' earned ');
          text(this.obj.get('value'));
          text(' ');
          text(Parse.User.current().get('credit_plural') || 'points');
          text(' for ');
          text(this.obj.get('name'));
          text(' ');
          text(moment(this.obj.createdAt).fromNow());
          return text('.');
        });
      });
      their_chore_performed_template = coffeecup.compile(function() {
        return li({
          'data-chore-id': '' + this.obj.id
        }, function() {
          text('&nbsp;');
          text('You earned ');
          text(this.obj.get('value'));
          text(' ');
          text(this.master_slave.get('credit_plural') || 'points');
          text(' for ');
          text(this.obj.get('name'));
          text(' ');
          text(moment(this.obj.createdAt).fromNow());
          return text('.');
        });
      });
      reward_template = coffeecup.compile(function() {
        return li({
          'data-reward-id': '' + this.obj.id
        }, function() {
          button({
            "class": 'btn btn-mini btn-danger destroy'
          }, function() {
            return i({
              "class": 'icon-trash icon-white'
            });
          });
          text('&nbsp;');
          text(this.master_slave.get('username'));
          text(' may ');
          text('&nbsp;');
          span({
            contenteditable: 'true',
            'data-attr': 'name'
          }, function() {
            return text(this.obj.get('name'));
          });
          text(' for ');
          span({
            contenteditable: 'true',
            'data-attr': 'cost'
          }, function() {
            return text(this.obj.get('cost'));
          });
          text(Parse.User.current().get('credit_plural') || 'points');
          return text('.');
        });
      });
      your_reward_claimed_template = coffeecup.compile(function() {
        return li({
          'data-reward-id': '' + this.obj.id
        }, function() {
          text('&nbsp;');
          text(this.master_slave.get('username'));
          text(' spent ');
          text(this.obj.get('cost'));
          text(' ');
          text(Parse.User.current().get('credit_plural') || 'points');
          text(' to ');
          text(this.obj.get('name'));
          text(' ');
          text(moment(this.obj.createdAt).fromNow());
          return text('.');
        });
      });
      their_reward_claimed_template = coffeecup.compile(function() {
        return li({
          'data-reward-id': '' + this.obj.id
        }, function() {
          text('&nbsp;');
          text('You spent ');
          text(this.obj.get('cost'));
          text(' ');
          text(this.master_slave.get('credit_plural') || 'points');
          text(' to ');
          text(this.obj.get('name'));
          text(' ');
          text(moment(this.obj.createdAt).fromNow());
          return text('.');
        });
      });
      their_chore_template = coffeecup.compile(function() {
        return li({
          'data-chore-id': '' + this.obj.id
        }, function() {
          text(' You may earn ');
          text(this.obj.get('value'));
          text(' ');
          text(this.master_slave.get('credit_plural') || 'points');
          text(' for ');
          text(this.obj.get('name'));
          return text('.');
        });
      });
      their_reward_template = coffeecup.compile(function() {
        return li({
          'data-reward-id': '' + this.obj.id
        }, function() {
          text(' You may ');
          text(this.obj.get('name'));
          text(' for ');
          text(this.obj.get('cost'));
          text(' ');
          text(this.master_slave.get('credit_plural') || 'points');
          text('. ');
          return button({
            "class": 'btn btn-mini btn-success claim',
            'data-cost': '' + this.obj.get('cost')
          }, function() {
            return i({
              "class": 'icon-shopping-cart icon-white'
            });
          });
        });
      });
      master_slave_dropdown_template = coffeecup.compile(function() {
        a({
          id: 'master_slave_drop',
          href: '#',
          role: 'button',
          "class": 'dropdown-toggle',
          'data-toggle': 'dropdown'
        }, function() {
          text('Master/Slave: ');
          span({
            "class": 'master_slave_username'
          });
          text('&nbsp;');
          return b({
            "class": 'caret'
          });
        });
        return ul({
          "class": 'dropdown-menu',
          role: 'menu',
          'aria-labelledby': 'master_slave_drop'
        }, function() {
          var sub, user, _i, _len, _ref, _results;
          if (this.subscriptions.length === 0) {
            li(function() {
              return 'You must add some friends, first! Ask them for their URL!';
            });
          }
          _ref = this.subscriptions;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            sub = _ref[_i];
            user = sub.get('master_slave');
            _results.push(li(function() {
              return a({
                tabindex: -1,
                href: '#',
                'data-username': user.get('username')
              }, function() {
                return text(user.get('username'));
              });
            }));
          }
          return _results;
        });
      });
      return $(function() {
        var Chore, ChorePerformed, Reward, RewardClaimed, Subscription, acl, app, currentSlave, currentUserView, isSubscribed, readOnly, slaveScore, subscriptions, yourScore;
        Parse.initialize("9v1vYmz7cxzMEENGmhDp3Zx3c4sJiJCMmResDL4i", "RnLqBUN1npB97MzJQnEjfcrQuEX3yARMPVBmrA3s");
        Chore = Parse.Object.extend('Chore');
        Reward = Parse.Object.extend('Reward');
        ChorePerformed = Parse.Object.extend('ChorePerformed');
        RewardClaimed = Parse.Object.extend('RewardClaimed');
        Subscription = Parse.Object.extend('Subscription');
        readOnly = void 0;
        currentUserView = void 0;
        subscriptions = {};
        currentSlave = void 0;
        yourScore = 0;
        slaveScore = 0;
        acl = void 0;
        isSubscribed = function(user, other, callback) {
          var q;
          q = new Parse.Query(Subscription);
          q.equalTo('user', Parse.User.current());
          q.equalTo('master_slave', other);
          q.include('master_slave');
          return q.find({
            success: function(results) {
              return callback(null, results.length > 0);
            },
            error: function(error) {
              return callback(error, false);
            }
          });
        };
        app = new Sammy(function() {
          var addObj, addTheirChore, addTheirChorePerformed, addTheirReward, addTheirRewardClaimed, addYourChore, addYourChorePerformed, addYourReward, addYourRewardClaimed, logged_in, populateChoresAndRewards, updateClaimButtons, yoursOrTheirs, _newProfile;
          this.get('#/', function() {
            $('.nav .active').removeClass('active');
            $('.content').hide();
            return $('#main').show();
          });
          this.get('#/user/:id', function() {
            var url, user_query;
            if (!(Parse.User.current() != null)) {
              alert('You must be logged in to do that.');
              this.redirect('#/');
              return;
            }
            $('.nav .active').removeClass('active');
            $('.content').hide();
            $('#user').show();
            currentUserView = void 0;
            if (this.params.id === Parse.User.current().id) {
              url = document.location.toString();
              $('#my_url a').attr('href', url).html(url);
              $('#my_username').val(Parse.User.current().get('username'));
              $('#credit_singular').val(Parse.User.current().get('credit_singular'));
              $('#credit_plural').val(Parse.User.current().get('credit_plural'));
              return $('#current_user').show();
            } else {
              user_query = new Parse.Query(Parse.User);
              return user_query.get(this.params.id, {
                success: function(user) {
                  $('.user_username').html(user.get('username'));
                  return isSubscribed(Parse.User.current(), user, function(error, subscribed) {
                    if (error != null) {
                      return alert(error.message);
                    } else {
                      if (subscribed) {
                        return $('.subscribed').show();
                      } else {
                        currentUserView = user;
                        return $('.not_subscribed').show();
                      }
                    }
                  });
                },
                error: function(user, error) {
                  return alert(error.message);
                }
              });
            }
          });
          yoursOrTheirs = function() {
            var user_query,
              _this = this;
            $('.content').hide();
            if (!(Parse.User.current() != null)) {
              this.redirect('#/');
              return;
            }
            if ((currentSlave != null) && (currentSlave.get('username') === this.params.username)) {
              return;
            }
            user_query = new Parse.Query(Parse.User);
            user_query.equalTo('username', this.params.username);
            return user_query.find({
              error: function(user, error) {
                return alert(error.message);
              },
              success: function(result) {
                var user;
                user = result[0];
                if (!(user != null)) {
                  _this.redirect('#/');
                  return;
                }
                return isSubscribed(Parse.User.current(), user, function(error, subscribed) {
                  if (error != null) {
                    return alert(error.message);
                  } else {
                    if (!subscribed) {
                      _this.redirect('#/');
                      return;
                    }
                    $('#yours_link').css('display', 'inline-block').attr('href', '#/yours/' + _this.params.username);
                    $('#theirs_link').css('display', 'inline-block').attr('href', '#/theirs/' + _this.params.username);
                    currentSlave = user;
                    $('.master_slave_username').html(_this.params.username);
                    $('.user_credit_plural').html(Parse.User.current().get('credit_plural') || 'points');
                    $('.master_slave_credit_plural').html(currentSlave.get('credit_plural') || 'points');
                    acl = new Parse.ACL(Parse.User.current());
                    acl.setPublicReadAccess(false);
                    acl.setPublicWriteAccess(false);
                    acl.setReadAccess(currentSlave, true);
                    populateChoresAndRewards(currentSlave);
                    $('.master_slave_points').html(slaveScore || 'no');
                    return $('.your_points').html(yourScore || 'no');
                  }
                });
              }
            });
          };
          this.get('#/yours/:username', function() {
            yoursOrTheirs.call(this);
            $('.nav .active').removeClass('active');
            $('.nav [href^="#/yours"]').parent().addClass('active');
            return $('#yours').show();
          });
          this.get('#/theirs/:username', function() {
            yoursOrTheirs.call(this);
            $('.nav .active').removeClass('active');
            $('.nav [href^="#/theirs"]').parent().addClass('active');
            return $('#theirs').show();
          });
          addObj = function(obj, master_slave, template) {
            var el;
            el = $(template({
              obj: obj,
              master_slave: master_slave
            }));
            el.find('[contenteditable=true]').blur(function(e) {
              return obj.save($(this).data('attr'), $(this).text(), {
                success: function(result) {
                  return obj = result;
                },
                error: function(error) {
                  return alert(error.message);
                }
              });
            });
            el.find('button.destroy').click(function(e) {
              obj.destroy();
              return $(this).parent().remove();
            });
            el.find('button.award').click(function(e) {
              var performed;
              performed = new ChorePerformed;
              performed.set('name', obj.get('name'));
              performed.set('value', obj.get('value'));
              performed.set('master', Parse.User.current());
              performed.set('slave', currentSlave);
              acl = new Parse.ACL(Parse.User.current());
              acl.setPublicReadAccess(false);
              acl.setPublicWriteAccess(false);
              acl.setReadAccess(currentSlave, true);
              performed.setACL(acl);
              return performed.save(null, {
                success: function(performed) {
                  performed = performed;
                  return addYourChorePerformed(performed, currentSlave);
                },
                error: function(performed, error) {
                  return alert(error.message);
                }
              });
            });
            el.find('button.claim').click(function(e) {
              var claimed, cost;
              cost = parseFloat($(this).data('cost'));
              if (cost > yourScore) {
                alert('You cannot afford that!');
                return;
              }
              claimed = new RewardClaimed;
              claimed.set('name', obj.get('name'));
              claimed.set('cost', obj.get('cost'));
              claimed.set('master', currentSlave);
              claimed.set('slave', Parse.User.current());
              acl = new Parse.ACL(Parse.User.current());
              acl.setPublicReadAccess(false);
              acl.setPublicWriteAccess(false);
              acl.setReadAccess(currentSlave, true);
              claimed.setACL(acl);
              return claimed.save(null, {
                success: function(claimed) {
                  claimed = claimed;
                  return addTheirRewardClaimed(claimed, currentSlave);
                },
                error: function(claimed, error) {
                  return alert(error.message);
                }
              });
            });
            return el;
          };
          updateClaimButtons = function() {
            return $('button.claim').each(function() {
              var cost;
              cost = parseFloat($(this).data('cost'));
              if ((cost != null) && (yourScore >= cost)) {
                return $(this).attr('disabled', false);
              } else {
                return $(this).attr('disabled', 'disabled');
              }
            });
          };
          addYourChore = function(chore, master_slave) {
            return $('#your_chores').prepend(addObj(chore, master_slave, chore_template));
          };
          addYourChorePerformed = function(chore, master_slave) {
            slaveScore += parseFloat(chore.get('value')) || 0;
            $('.master_slave_points').html(slaveScore || 'no');
            return $('#your_chores_performed').prepend(addObj(chore, master_slave, chore_performed_template));
          };
          addYourReward = function(reward, master_slave) {
            return $('#your_rewards').prepend(addObj(reward, master_slave, reward_template));
          };
          addYourRewardClaimed = function(reward, master_slave) {
            slaveScore -= parseFloat(reward.get('cost')) || 0;
            $('.master_slave_points').html(slaveScore || 'no');
            return $('#your_rewards_claimed').prepend(addObj(reward, master_slave, your_reward_claimed_template));
          };
          addTheirChore = function(chore, master_slave) {
            return $('#their_chores').prepend(addObj(chore, master_slave, their_chore_template));
          };
          addTheirChorePerformed = function(chore, master_slave) {
            yourScore += parseFloat(chore.get('value')) || 0;
            $('.your_points').html(yourScore || 'no');
            $('#their_chores_performed').prepend(addObj(chore, master_slave, their_chore_performed_template));
            return updateClaimButtons();
          };
          addTheirReward = function(reward, master_slave) {
            return $('#their_rewards').prepend(addObj(reward, master_slave, their_reward_template));
          };
          addTheirRewardClaimed = function(reward, master_slave) {
            yourScore -= parseFloat(reward.get('cost')) || 0;
            $('.your_points').html(yourScore || 'no');
            $('#their_rewards_claimed').prepend(addObj(reward, master_slave, their_reward_claimed_template));
            return updateClaimButtons();
          };
          populateChoresAndRewards = function(master_slave) {
            var chore_query, reward_query;
            if ($('body').data('populatedFor') === master_slave.get('username')) {
              return;
            }
            slaveScore = 0;
            yourScore = 0;
            $('body').data({
              populatedFor: master_slave.get('username')
            });
            $('#your_chores').html('Please Wait...');
            chore_query = new Parse.Query(Chore);
            chore_query.equalTo('user', Parse.User.current());
            chore_query.equalTo('slave', master_slave);
            chore_query.ascending('value');
            chore_query.find({
              success: function(chores) {
                var chore, _i, _len, _results;
                $('#your_chores').html('');
                _results = [];
                for (_i = 0, _len = chores.length; _i < _len; _i++) {
                  chore = chores[_i];
                  _results.push(addYourChore(chore, master_slave));
                }
                return _results;
              },
              error: function(error) {
                return alert(error.message);
              }
            });
            $('#their_chores').html('Please Wait...');
            chore_query = new Parse.Query(Chore);
            chore_query.equalTo('user', master_slave);
            chore_query.equalTo('slave', Parse.User.current());
            chore_query.ascending('value');
            chore_query.find({
              success: function(chores) {
                var chore, _i, _len, _results;
                $('#their_chores').html('');
                _results = [];
                for (_i = 0, _len = chores.length; _i < _len; _i++) {
                  chore = chores[_i];
                  _results.push(addTheirChore(chore, master_slave));
                }
                return _results;
              },
              error: function(error) {
                return alert(error.message);
              }
            });
            $('#your_chores_performed').html('Please Wait...');
            chore_query = new Parse.Query(ChorePerformed);
            chore_query.equalTo('master', Parse.User.current());
            chore_query.equalTo('slave', master_slave);
            chore_query.ascending('createdAt');
            chore_query.find({
              success: function(chores) {
                var chore, _i, _len, _results;
                $('#your_chores_performed').html('');
                _results = [];
                for (_i = 0, _len = chores.length; _i < _len; _i++) {
                  chore = chores[_i];
                  _results.push(addYourChorePerformed(chore, master_slave));
                }
                return _results;
              },
              error: function(error) {
                return alert(error.message);
              }
            });
            $('#their_chores_performed').html('Please Wait...');
            chore_query = new Parse.Query(ChorePerformed);
            chore_query.equalTo('master', master_slave);
            chore_query.equalTo('slave', Parse.User.current());
            chore_query.ascending('createdAt');
            chore_query.find({
              success: function(chores) {
                var chore, _i, _len, _results;
                $('#their_chores_performed').html('');
                _results = [];
                for (_i = 0, _len = chores.length; _i < _len; _i++) {
                  chore = chores[_i];
                  _results.push(addTheirChorePerformed(chore, master_slave));
                }
                return _results;
              },
              error: function(error) {
                return alert(error.message);
              }
            });
            $('#your_rewards').html('Please Wait...');
            reward_query = new Parse.Query(Reward);
            reward_query.equalTo('user', Parse.User.current());
            reward_query.ascending('cost');
            if (master_slave != null) {
              reward_query.equalTo('slave', master_slave);
            }
            reward_query.find({
              success: function(rewards) {
                var reward, _i, _len, _results;
                $('#your_rewards').html('');
                _results = [];
                for (_i = 0, _len = rewards.length; _i < _len; _i++) {
                  reward = rewards[_i];
                  _results.push(addYourReward(reward, master_slave));
                }
                return _results;
              },
              error: function(error) {
                return alert(error.message);
              }
            });
            $('#their_rewards').html('Please Wait...');
            reward_query = new Parse.Query(Reward);
            reward_query.equalTo('user', master_slave);
            reward_query.equalTo('slave', Parse.User.current());
            reward_query.ascending('cost');
            reward_query.find({
              success: function(rewards) {
                var reward, _i, _len, _results;
                $('#their_rewards').html('');
                _results = [];
                for (_i = 0, _len = rewards.length; _i < _len; _i++) {
                  reward = rewards[_i];
                  _results.push(addTheirReward(reward, master_slave));
                }
                return _results;
              },
              error: function(error) {
                return alert(error.message);
              }
            });
            $('#your_rewards_claimed').html('Please Wait...');
            reward_query = new Parse.Query(RewardClaimed);
            reward_query.equalTo('master', Parse.User.current());
            reward_query.equalTo('slave', master_slave);
            reward_query.ascending('createdAt');
            reward_query.find({
              success: function(rewards) {
                var reward, _i, _len, _results;
                $('#your_rewards_claimed').html('');
                _results = [];
                for (_i = 0, _len = rewards.length; _i < _len; _i++) {
                  reward = rewards[_i];
                  _results.push(addYourRewardClaimed(reward, master_slave));
                }
                return _results;
              },
              error: function(error) {
                return alert(error.message);
              }
            });
            $('#their_rewards_claimed').html('Please Wait...');
            reward_query = new Parse.Query(RewardClaimed);
            reward_query.equalTo('master', master_slave);
            reward_query.equalTo('slave', Parse.User.current());
            reward_query.ascending('createdAt');
            return reward_query.find({
              success: function(rewards) {
                var reward, _i, _len, _results;
                $('#their_rewards_claimed').html('');
                _results = [];
                for (_i = 0, _len = rewards.length; _i < _len; _i++) {
                  reward = rewards[_i];
                  _results.push(addTheirRewardClaimed(reward, master_slave));
                }
                return _results;
              },
              error: function(error) {
                return alert(error.message);
              }
            });
          };
          logged_in = function(user) {
            var user_query;
            subscriptions = {};
            yourScore = 0;
            $('.username_display').text(user.get('username'));
            $('#not_logged_in').hide();
            $('#logged_in').show();
            $('#master_slave_dropdown').html('Please Wait...');
            user_query = new Parse.Query(Subscription);
            user_query.equalTo('user', Parse.User.current());
            user_query.include('master_slave');
            return user_query.find({
              success: function(results) {
                var master_slave, subscription, _i, _len;
                subscriptions = {};
                for (_i = 0, _len = results.length; _i < _len; _i++) {
                  subscription = results[_i];
                  master_slave = subscription.get('master_slave');
                  subscriptions[master_slave.get('username')] = master_slave;
                }
                return $('#master_slave_dropdown').html(master_slave_dropdown_template({
                  subscriptions: results
                })).show();
              },
              error: function(error) {
                $('#master_slave_dropdown').html('');
                return alert(error.message);
              }
            });
          };
          $('#log-in').submit(function(e) {
            var name, pass;
            e.preventDefault();
            name = $('#log-in-name').val();
            pass = $('#log-in-pass').val();
            Parse.User.logIn(name, pass, {
              success: function(user) {
                return logged_in(user);
              },
              error: function(user, error) {
                return alert(error.message);
              }
            });
            $('#log-in-name').val('');
            $('#log-in-pass').val('');
            return false;
          });
          _newProfile = {
            credit_singular: 'point',
            credit_plural: 'points'
          };
          $('#sign-up').submit(function(e) {
            var email, key, name, pass, user, val;
            e.preventDefault();
            name = $('#sign-up-name').val();
            pass = $('#sign-up-pass').val();
            email = $('#sign-up-email').val();
            user = new Parse.User;
            user.set('username', name);
            user.set('password', pass);
            user.set('email', email);
            for (key in _newProfile) {
              if (!__hasProp.call(_newProfile, key)) continue;
              val = _newProfile[key];
              user.set(key, val);
            }
            user.signUp(null, {
              success: function(user) {
                return Parse.User.logIn(name, pass, {
                  success: function(user) {
                    return logged_in(user);
                  },
                  error: function(user, error) {
                    return alert(error.message);
                  }
                });
              },
              error: function(user, error) {
                return alert(error.message);
              }
            });
            $('#sign-up-name').val('');
            $('#sign-up-pass').val('');
            $('#new_profile_email').val('');
            return false;
          });
          $('#log-out').click(function() {
            Parse.User.logOut();
            $('#logged_in').hide();
            $('#not_logged_in').show();
            return app.setLocation('#/');
          });
          $('#add-chore').click(function() {
            var chore;
            chore = new Chore;
            chore.set('name', 'doing something awesome');
            chore.set('value', '10');
            chore.set('user', Parse.User.current());
            chore.set('slave', currentSlave);
            acl = new Parse.ACL(Parse.User.current());
            acl.setPublicReadAccess(false);
            acl.setPublicWriteAccess(false);
            acl.setReadAccess(currentSlave, true);
            chore.setACL(acl);
            chore.save(null, {
              success: function(chore) {
                return chore = chore;
              },
              error: function(chore, error) {
                return alert(error.message);
              }
            });
            return addYourChore(chore, currentSlave);
          });
          $('#add-reward').click(function() {
            var reward;
            reward = new Reward;
            reward.set('name', 'get something');
            reward.set('cost', '10');
            reward.set('user', Parse.User.current());
            reward.set('slave', currentSlave);
            reward.setACL(acl);
            reward.save(null, {
              success: function(reward) {
                return reward = reward;
              },
              error: function(reward, error) {
                return alert(error.message);
              }
            });
            return addYourReward(reward, currentSlave);
          });
          $('#master_slave_dropdown a[data-username]').live('click', function(e) {
            var username;
            e.preventDefault();
            username = $(this).data('username');
            app.setLocation('#/yours/' + username);
            return false;
          });
          $('[contenteditable=true]').live('keydown', function(e) {
            if (e.which === 13) {
              $(this).blur();
              return false;
            }
          });
          $('#subscribe').click(function(e) {
            var sub;
            sub = new Subscription;
            sub.set('user', Parse.User.current());
            sub.set('master_slave', currentUserView);
            acl = new Parse.ACL(Parse.User.current());
            acl.setPublicReadAccess(false);
            acl.setPublicWriteAccess(false);
            acl.setReadAccess(currentUserView, true);
            sub.setACL(acl);
            return sub.save(null, {
              success: function(reward) {
                reward = reward;
                return window.location.reload();
              },
              error: function(reward, error) {
                return alert(error.message);
              }
            });
          });
          $('#myself').click(function(e) {
            app.setLocation('#/user/' + Parse.User.current().id);
            return false;
          });
          $('#update_myself').submit(function(e) {
            e.preventDefault();
            $('#update_myself input').blur();
            $('#update_myself button').button('loading');
            Parse.User.current().set('username', $('#my_username').val());
            Parse.User.current().set('credit_singular', $('#credit_singular').val());
            Parse.User.current().set('credit_plural', $('#credit_plural').val());
            if (!Parse.User.current().dirty()) {
              return false;
            }
            Parse.User.current().save(null, {
              success: function(user) {
                $('#update_myself button').button('reset');
                return logged_in(user);
              },
              error: function(user, error) {
                $('#update_myself button').button('reset');
                return alert(error.message);
              }
            });
            return false;
          });
          if (Parse.User.current()) {
            logged_in(Parse.User.current());
            readOnly = new Parse.ACL(Parse.User.current());
            readOnly.setPublicReadAccess(false);
            return readOnly.setPublicWriteAccess(false);
          }
        });
        return app.run('#/');
      });
    }).call(this);</script></body></html>